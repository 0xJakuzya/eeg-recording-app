## EEG Recording App

Мобильное Flutter‑приложение для регистрации ЭЭГ‑сигналов с 8‑канальных BLE‑устройств, управления записями и интеграции с сервером полисомнографии для анализа сна. Поддерживает подключение по Bluetooth Low Energy, приём и визуализацию данных в реальном времени, запись в csv/txt, просмотр файлов и получение предсказаний стадий сна.

---

## Основные возможности

- **Подключение к BLE‑устройствам**
  - Сканирование и подключение к EEG BLE‑устройствам
  - Отслеживание состояния подключения

- **Запись ЭЭГ в реальном времени**
  - Потоковая запись в csv/txt файлы с буферизацией
  - Автоматическое разбиение по сессиям и датам

- **Онлайн‑визуализация сигналов**
  - Отображение сигналов в реальном времени
  - Скользящее окно и регулировка масштаба амплитуды
  - Фильтры и базовые преобразования сигналов

- **Работа с файлами**
  - Просмотр списка записей и директорий
  - Детальная информация по файлам (дата, размер)
  - Удаление и шаринг записей
  - Просмотр содержимого csv/txt прямо в приложении

- **Интеграция с сервисом полисомнографии**
  - Загрузка файлов ЭЭГ на внешний сервер полисомнографии
  - Получение списка файлов пациента и запуск предсказания
  - Отображение статуса обработки и предсказаний по сессиям
  - Просмотр гипнограммы и интервалов стадий сна

- **Настройки**
  - Основыне настройки мобильного приложения: папка для записей, разбиение файлов, формат преобразования данных ble-устройств(int8, int12)

---

## Архитектура данных

### Запись ЭЭГ

```text
EEG Device (ble)
    ↓ 
BleController (subscribe ble)
    ↓ 
EegParserService (bytes → eegSample, int8)
    ↓
CsvStreamWriter (append + period flush)
    ↓ 
File Storage (/Documents/<dd.MM.yyyy>/session_N/*.txt)
```

### Обработка и анализ сна

```text
txt files session
    ↓
UploadFile/Predict
    ↓
Backend Polysomnography (REST API)
    ↓
JSON с предсказаниями стадий сна + индекс session_N
    ↓
ProcessedSession (status, prediction, jsonIndex)
    ↓
FilesProcessedPage (UI)
```

---

## Установка и запуск

1. Установите Flutter SDK (рекомендуется 3.10.7+)
2. Установите зависимости:

   ```bash
   flutter pub get
   ```

3. Запустите приложение:

   ```bash
   flutter run
   ```
---

## Структура проекта

```text
lib/
├── controllers/                    # управление состоянием
│   ├── ble_controller.dart         # ble‑подключение и сканирование
│   ├── recording_controller.dart   # управление записью данных и сессиями
│   ├── settings_controller.dart    # настройки приложения
│   └── files_controller.dart       # работа с файлами и директориями записей
│
├── services/                       # бизнес‑логика
│   ├── csv_stream_service.dart     # потоковая запись в csv/txt
│   ├── eeg_parser_service.dart     # парсинг ble‑байтов в выборки ЭЭГ
│   └── polysomnography_service.dart# HTTP‑клиент для API полисомнографии
│
├── models/                         # модели данных
│   ├── eeg_sample.dart             # модель сэмпла ЭЭГ
│   ├── recording_models.dart       # описание файлов/директорий записей
│   └── processed_session.dart      # информация об обработанных сессиях сна
│
├── views/                          # экраны приложения
│   ├── connection_page.dart        # подключение к устройствам
│   ├── recording_page.dart         # запись и визуализация сигналов
│   ├── files_page.dart             # управление файлами записей
│   ├── files_processed_page.dart   # список обработанных сессий сна
│   ├── csv_view_page.dart          # просмотр содержимого csv/txt
│   └── session_details_page.dart   # детали предсказаний и гипнограмма (statistics)
│
├── widgets/                        # переиспользуемые виджеты
│   ├── eeg_plots.dart              # графики сигналов ЭЭГ
│   ├── recording_status_card.dart  # карточка статуса записи
│   └── connection_status.dart      # статус BLE‑подключения
│
└── core/                           # константы и конфигурация
    ├── ble_constants.dart          # настройки BLE‑сервиса/характеристик
    ├── recording_constants.dart    # константы записи и формата файлов
    └── polysomnography_constants.dart # URL и параметры API полисомнографии
```
